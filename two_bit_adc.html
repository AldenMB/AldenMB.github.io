<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>A Two Bit Analog-Digital Converter</title>
        <link rel="stylesheet" href="https://aldenbradford.com/theme/css/main.css" />
        <link href="https://aldenbradford.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Alden Bradford Atom Feed" />
        <meta name="description" content="A surprisingly simple circuit gives a reliable two bit analog-digital converter using only one integrated circuit chip." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://aldenbradford.com/">Alden Bradford</a></h1>
                <nav><ul>
                    <li><a href="https://aldenbradford.com/">Welcome</a></li>
                    <li class="active"><a href="https://aldenbradford.com/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://aldenbradford.com/two_bit_adc.html" rel="bookmark"
           title="Permalink to A Two Bit Analog-Digital Converter">A Two Bit Analog-Digital Converter</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2022-07-12T00:00:00-04:00">
                Published: Tue 12 July 2022
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://aldenbradford.com/author/alden-bradford.html">Alden Bradford</a>
        </address>
<p>In <a href="https://aldenbradford.com/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://aldenbradford.com/tag/electronics.html">Electronics</a> </p>
</footer><!-- /.post-info -->      <p>For a project I am working on I need to read the signal driving a multiplexed segment LCD. The signal switches between four voltage levels (0, 1.5, 3, and 4.5), across 32 different pins. Here I will describe a few ways to recover that signal onto a microcontroller.</p>
<h1>An off-the-shelf ADC chip</h1>
<p>We only need two bits of information to distinguish between the four voltage levels. Even the cheapest ADCs give a whole eight bits -- <a href="https://www.digikey.com/en/products/detail/touchstone-semiconductor/TS7003ITD833T/3645626">the cheapest ADC on Digikey</a> right now gives you eight bits and communicates over SPI, and would cost just under a dollar a piece. More realistically, there are eight-input ADCs which cost more like $4 each in small quantities, which would be a better deal over all.</p>
<h2>Advantages</h2>
<ul>
<li>It's dead simple to implement, fairly easy to understand.</li>
</ul>
<h2>Disadvantages</h2>
<ul>
<li>
<p>It's power-hungry, both from the power rails and from the the data signals. An LCD driver usually has to put out basically zero current, and a low-end ADC might consume a noticeable amount, possibly more than the LCD driver is comfortable supplying.</p>
</li>
<li>
<p>It's noisy, since it puts a time-varying load on the signal wires.</p>
</li>
<li>
<p>It's expensive!</p>
</li>
</ul>
<h1>A handfull of microcontrollers</h1>
<p>Here is a cheaper solution, which would also need way fewer parts. I have a bunch of Arduino Nano microcontrollers around, and each one has eight ADC inputs. We can set four of them to sample the circuit.</p>
<h2>Advantages</h2>
<ul>
<li>
<p>Very few additional components, since it has most of the circuitry we need included.</p>
</li>
<li>
<p>Cheap: I already have them so it's basically free, but even if you didn't have them on hand the off-brand ones cost about $3 each.</p>
</li>
</ul>
<h2>Disadvantages</h2>
<ul>
<li>
<p>Still noisy and power-hungry</p>
</li>
<li>
<p>We have to write code for the microcontrollers</p>
</li>
</ul>
<h1>A resistance ladder (flash) ADC</h1>
<p>A better solution is to wire up our own 2-bit ADC. A traditional way to do this would be to use three comparators and a resistance ladder. Something like this.</p>
<p><img alt="a picture of a traditional flash ADC" src="https://aldenbradford.com/traditional_flash_adc.svg" width="300"></p>
<h2>Advantages</h2>
<ul>
<li>
<p>Low power, low noise. If we use a good mosfet comparator this can consume basically no power except when the input value changes. The resistance ladder sets thresholds at 1.25, 2.5, and 3.75 which nicely divides the voltage levels we are comparing.</p>
</li>
<li>
<p>Independent of component values. We can use any resistors we like, and any comparator chip. This makes it potentially very cheap.</p>
</li>
<li>
<p>Solid-state. The outputs are simple digital high and low values, so we can hook them up to a shift register, or even use them for interrupts on our microcontroller. This also makes it very easy to debug, since all the logic is visible.</p>
</li>
</ul>
<h2>Disadvantages</h2>
<ul>
<li>
<p>Uses an odd number of components. Comparators are usually available in packages of two or four, and this uses three.</p>
</li>
<li>
<p>The output requires processing. We could take a digital output straight from the comparators, but then we would be using three wires to send two bits. We need those some additional logic chips to bring it down to two, which adds to the complexity. A repeatable unit of these on a board would necessarily process multiple signals and include several ICs so as to make use of every available gate.</p>
</li>
</ul>
<h1>A creative solution</h1>
<p>Here is the design I have settled on.</p>
<p><img alt="a compact 2-bit ADC" src="https://aldenbradford.com/compact_adc.svg" width="300"></p>
<p>This manages to get our output using just two comparators. The two resistors take the average from the high-bit and the 2.5 volt rail, and use that as the threshold for the other comparator.</p>
<h2>Advantages</h2>
<p>This has all the benefits from the flash ADC, plus it only takes 2 resistors and half of a 4-comparator IC. This makes it easier to assemble, and way cheaper -- less than 22 cents per input, in small quantities.</p>
<h2>Disadvantages</h2>
<p>Requires a low-impedance 2.5 volt rail. This is not a problem for me, since I have a handful of 2.5 volt regulators on hand. Of course, all the comparators for the whole project can share the same rail, so this doesn't add much to our part count. If you only had a couple of these to do, here is an alternative arrangement you could use which only needs the power rail, and a few more resistors.</p>
<p><img alt="a version which does not need a 2.5 volt rail" height="250" src="https://aldenbradford.com/no_reference_adc.svg"></p>
<p>This also reduces the noise on the 2.5 volt reference line, which could reduce the chance of jittering on the output. In the previous version, if signal A changes its low bit while B is changing its high bit, the small leakage from the feedback circuit of B could prevent a clean transition on A. This circuit solves that.</p>
<h1>Generalizing</h1>
<p>I think this is a neat topology! If you are familiar with R-2R ladders, it is probably clear to you how we could generalize this circuit to make an ADC of arbitrary precision, at least on paper. Bit n would be generated like this.</p>
<p><img alt="how to form bit n of an ADC of this topology" height="200" src="https://aldenbradford.com/r_2r_adc.svg"></p>
<p>Essentially, we use an R-2R ladder as a DAC, giving the best approximation to the signal if bit n were high. We compare that to the actual signal to see if bit n should be high. Each bit only uses inputs from the higher-order bits, so I don't expect there is any danger of oscillation.</p>
<h1>Conclusion</h1>
<p>This is actually a special case of a really common design called a "subranging" flash. Usually designers will use more bits in a stage before going to an ADC, which gets them decreased latency and better monotonicity. Since these are usually all integrated onto a single chip they can make the priority encoder cheaply on the chip without any messy routing.</p>
<p>In my design it makes sense to incorporate feedback after just one bit. I get to use an off-the-shelf part (the comparator) for a very specialized purpose, all with the addition of just two resistors. It's good to keep an open mind, try out several designs, even for an undemanding task like this. Doing it the traditional way with a full 8-bit ADC on each line, or even using standard 2-bit ADC design, would lead to a needlessly expensive and complicated circuit. This custom design will do more with less.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://github.com/AldenMB">My GitHub</a></li>
                            <li><a href="https://nt-tl.net/">My wife</a></li>
                            <li><a href="https://laurestine.github.io/">My sister</a></li>
                            <li><a href="https://www.clintonbradford.com/">My brother</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://aldenbradford.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>